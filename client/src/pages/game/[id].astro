---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';
import GameDetails from '../../components/GameDetails.svelte';
import GameSchema from '../../components/GameSchema.astro';

const { id } = Astro.params;
const gameId = parseInt(id || '0');

// Fetch game data for SEO metadata
let gameData = null;
let pageTitle = "Game Details - Tailspin Toys";
let pageDescription = "Discover an exciting developer-themed board game on Tailspin Toys crowdfunding platform.";

try {
  const response = await fetch(`http://localhost:5100/api/games/${gameId}`);
  if (response.ok) {
    gameData = await response.json();
    // Create SEO-optimized title and description
    pageTitle = `${gameData.title} - Developer Board Game | Tailspin Toys`;
    
    // Create description with proper ellipsis handling
    const descriptionText = gameData.description;
    if (descriptionText.length > 140) {
      pageDescription = `Back ${gameData.title} on Tailspin Toys. ${descriptionText.substring(0, 140)}...`;
    } else {
      pageDescription = `Back ${gameData.title} on Tailspin Toys. ${descriptionText}`;
    }
  }
} catch (error) {
  console.error('Error fetching game data for SEO:', error);
}

---

<Layout 
  title={pageTitle}
  description={pageDescription}
>
  {gameData && <GameSchema game={gameData} />}
  
  <div class="py-8">
    <GameDetails client:load gameId={gameId} />
    
    <div class="mt-8">
      <a href="/" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-300 inline-flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        Back to all games
      </a>
    </div>
  </div>
</Layout>